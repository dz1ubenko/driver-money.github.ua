<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Money - –¢—Ä–µ–∫–µ—Ä –∑–∞—Ä–æ–±—ñ—Ç–∫—É</title>
    <link rel="stylesheet" href="driver_money_css.css">
</head>
<body>
    <div id="app"></div>

    <script>
        // State management
        let showSplash = true;
        let splashAnimationComplete = false;
        let view = 'home';
        let workDays = [];
        let categories = [];
        let formData = {
            date: new Date().toISOString().split('T')[0],
            categoryId: '',
            value: ''
        };
        let categoryForm = {
            name: '',
            type: 'simple',
            rate: '',
            rule1Limit: '30',
            rule1Rate: '20',
            rule2Rate: '17'
        };

        // Helper functions
        function getFirstDayOfMonth() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), 1);
        }

        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function formatCurrency(amount) {
            return `‚Ç¥${amount.toLocaleString('uk-UA')}`;
        }

        function calculateEarnings(category, value) {
            if (!category || !value) return 0;

            if (category.type === 'km_rules' && category.rules) {
                const km = parseFloat(value);
                for (let rule of category.rules) {
                    if (km <= rule.limit) {
                        return km * rule.rate;
                    }
                }
            } else if (category.rate) {
                return category.rate * parseFloat(value);
            }
            return 0;
        }

        function getTotalEarnings() {
            const firstDay = getFirstDayOfMonth();
            return workDays
                .filter(day => new Date(day.date) >= firstDay)
                .reduce((sum, day) => sum + day.amount, 0);
        }

        function getValueLabel(type) {
            return type || '–æ–¥.';
        }

        // Load data from localStorage
        function loadData() {
            const savedWorkDays = localStorage.getItem('workDays');
            const savedCategories = localStorage.getItem('categories');
            
            if (savedWorkDays) {
                workDays = JSON.parse(savedWorkDays);
            }
            
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            }
        }

        // Save data to localStorage
        function saveWorkDays() {
            localStorage.setItem('workDays', JSON.stringify(workDays));
        }

        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        // Handle actions
        function handleAddWorkDay() {
            const category = categories.find(c => c.id === formData.categoryId);
            if (!category || !formData.value) return;

            const amount = calculateEarnings(category, formData.value);
            
            const newWorkDay = {
                id: Date.now().toString(),
                date: formData.date,
                categoryId: formData.categoryId,
                categoryName: category.name,
                value: parseFloat(formData.value),
                valueType: category.valueType,
                amount: amount
            };

            workDays.push(newWorkDay);
            workDays.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveWorkDays();
            
            formData = {
                date: new Date().toISOString().split('T')[0],
                categoryId: '',
                value: ''
            };
            view = 'home';
            render();
        }

        function handleDeleteWorkDay(id) {
            workDays = workDays.filter(day => day.id !== id);
            saveWorkDays();
            render();
        }

        function handleAddCategory() {
            if (!categoryForm.name) return;

            let newCategory = {
                id: Date.now().toString(),
                name: categoryForm.name
            };

            if (categoryForm.type === 'km_rules') {
                newCategory.type = 'km_rules';
                newCategory.valueType = '–∫–º';
                newCategory.rules = [
                    { limit: parseFloat(categoryForm.rule1Limit), rate: parseFloat(categoryForm.rule1Rate) },
                    { limit: Infinity, rate: parseFloat(categoryForm.rule2Rate) }
                ];
            } else {
                newCategory.type = 'simple';
                newCategory.rate = parseFloat(categoryForm.rate);
                newCategory.valueType = categoryForm.type === 'trip' ? '—Ä–µ–π—Å(—ñ–≤)' : '–æ–¥.';
            }

            categories.push(newCategory);
            saveCategories();
            
            categoryForm = {
                name: '',
                type: 'simple',
                rate: '',
                rule1Limit: '30',
                rule1Rate: '20',
                rule2Rate: '17'
            };
            view = 'categories';
            render();
        }

        function handleDeleteCategory(id) {
            categories = categories.filter(c => c.id !== id);
            saveCategories();
            render();
        }

        // Render functions
        function renderSplash() {
            return `
                <div class="splash-screen">
                    <div class="clouds-container">
                        <div class="cloud cloud-1"></div>
                        <div class="cloud cloud-2"></div>
                        <div class="cloud cloud-3"></div>
                    </div>

                    <div class="truck-container">
                        <svg viewBox="0 0 300 150" class="truck">
                            <rect x="80" y="30" width="180" height="80" rx="4" fill="#ffffff" stroke="#d1d5db" stroke-width="2"/>
                            <line x1="140" y1="30" x2="140" y2="110" stroke="#d1d5db" stroke-width="1"/>
                            <line x1="200" y1="30" x2="200" y2="110" stroke="#d1d5db" stroke-width="1"/>
                            <line x1="80" y1="60" x2="260" y2="60" stroke="#d1d5db" stroke-width="1"/>
                            <line x1="80" y1="80" x2="260" y2="80" stroke="#d1d5db" stroke-width="1"/>
                            <rect x="30" y="50" width="60" height="60" rx="4" fill="#ffffff" stroke="#d1d5db" stroke-width="2"/>
                            <path d="M 30 50 L 50 35 L 80 35 L 90 50 Z" fill="#ffffff" stroke="#d1d5db" stroke-width="2"/>
                            <rect x="35" y="55" width="20" height="18" rx="2" fill="#4f46e5" opacity="0.7"/>
                            <rect x="60" y="55" width="25" height="18" rx="2" fill="#4f46e5" opacity="0.7"/>
                            <path d="M 52 38 L 62 38 L 65 48 L 50 48 Z" fill="#4f46e5" opacity="0.7"/>
                            <line x1="55" y1="75" x2="55" y2="110" stroke="#d1d5db" stroke-width="2"/>
                            <circle cx="60" cy="115" r="12" fill="#333" stroke="#222" stroke-width="2"/>
                            <circle cx="60" cy="115" r="6" fill="#666"/>
                            <circle cx="110" cy="115" r="12" fill="#333" stroke="#222" stroke-width="2"/>
                            <circle cx="110" cy="115" r="6" fill="#666"/>
                            <circle cx="230" cy="115" r="12" fill="#333" stroke="#222" stroke-width="2"/>
                            <circle cx="230" cy="115" r="6" fill="#666"/>
                            <rect x="32" y="90" width="4" height="15" rx="1" fill="#fbbf24"/>
                            <rect x="32" y="75" width="3" height="8" rx="1" fill="#333"/>
                            <rect x="32" y="82" width="3" height="3" rx="1" fill="#ef4444"/>
                        </svg>
                    </div>

                    ${[1,2,3,4,5,6,7,8,9,10].map(i => `
                        <div class="box box-${i}">
                            <div class="box-inner box-color-${i}"></div>
                        </div>
                    `).join('')}

                    <div class="title-container">
                        <div class="title-card">
                            <h1 class="title">Driver Money</h1>
                            <div class="title-decoration">
                                <div class="line line-left"></div>
                                <div class="dot"></div>
                                <div class="line line-right"></div>
                            </div>
                            <p class="subtitle">–¢–≤—ñ–π –æ—Å–æ–±–∏—Å—Ç–∏–π —Ç—Ä–µ–∫–µ—Ä –∑–∞—Ä–æ–±—ñ—Ç–∫—É</p>
                        </div>
                    </div>

                    ${splashAnimationComplete ? `
                        <button onclick="showSplash = false; render();" class="continue-button">
                            –†–æ–∑–ø–æ—á–∞—Ç–∏ üöÄ
                        </button>
                    ` : ''}
                </div>
            `;
        }

        function renderHome() {
            return `
                <div class="home-screen">
                    <div class="earnings-display">
                        <p class="earnings-label">–ó–∞—Ä–æ–±—ñ—Ç–æ–∫ –∑–∞ –º—ñ—Å—è—Ü—å</p>
                        <h1 class="earnings-amount">${formatCurrency(getTotalEarnings())}</h1>
                        <p class="earnings-date">–∑ ${formatDate(getFirstDayOfMonth())}</p>
                    </div>
                    
                    <div class="home-buttons">
                        <button onclick="view = 'details'; render();" class="home-btn">
                            <span class="icon">üìä</span>
                            –î–µ—Ç–∞–ª—ñ
                        </button>
                        
                        <button onclick="view = 'categories'; render();" class="home-btn">
                            <span class="icon">‚úèÔ∏è</span>
                            –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó
                        </button>
                    </div>

                    <button onclick="view = 'add'; render();" class="fab">
                        <span class="fab-icon">+</span>
                    </button>
                </div>
            `;
        }

        function renderAddForm() {
            const selectedCategory = categories.find(c => c.id === formData.categoryId);
            const calculatedAmount = selectedCategory && formData.value ? 
                calculateEarnings(selectedCategory, formData.value) : 0;

            return `
                <div class="form-screen">
                    <div class="form-header">
                        <button onclick="view = 'home'; render();" class="back-btn">‚Üê</button>
                        <h2>–ù–æ–≤–∏–π —Ä–æ–±–æ—á–∏–π –¥–µ–Ω—å</h2>
                    </div>

                    <div class="form-card">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞</label>
                            <input type="date" id="workDate" value="${formData.date}" 
                                onchange="formData.date = this.value; render();">
                        </div>

                        <div class="form-group">
                            <label>–ö–æ–º–ø–∞–Ω—ñ—è</label>
                            <select id="workCategory" onchange="formData.categoryId = this.value; render();">
                                <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–æ–º–ø–∞–Ω—ñ—é</option>
                                ${categories.map(cat => `
                                    <option value="${cat.id}" ${formData.categoryId === cat.id ? 'selected' : ''}>
                                        ${cat.name}
                                    </option>
                                `).join('')}
                            </select>
                            
                            ${categories.length === 0 ? '<p class="hint">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</p>' : ''}
                            
                            <button onclick="view = 'addCategory'; render();" class="add-category-btn">
                                + –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –∫–æ–º–ø–∞–Ω—ñ—é
                            </button>
                        </div>

                        ${formData.categoryId ? `
                            <div class="form-group">
                                <label>${selectedCategory.type === 'km_rules' ? '–ö—ñ–ª–æ–º–µ—Ç—Ä–∏' : '–ó–Ω–∞—á–µ–Ω–Ω—è'}</label>
                                <input type="number" id="workValue" value="${formData.value}" 
                                    placeholder="–í–≤–µ–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è"
                                    onchange="formData.value = this.value; render();">
                            </div>
                        ` : ''}

                        ${formData.categoryId && formData.value ? `
                            <div class="calculated-amount">
                                <p class="calculated-label">–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞:</p>
                                <p class="calculated-value">${formatCurrency(calculatedAmount)}</p>
                            </div>
                        ` : ''}

                        <button onclick="handleAddWorkDay()" 
                            ${!formData.categoryId || !formData.value ? 'disabled' : ''}
                            class="submit-btn">
                            –ó–±–µ—Ä–µ–≥—Ç–∏
                        </button>
                    </div>
                </div>
            `;
        }

        function renderDetails() {
            const currentMonthDays = workDays.filter(day => new Date(day.date) >= getFirstDayOfMonth());

            return `
                <div class="details-screen">
                    <div class="form-header">
                        <button onclick="view = 'home'; render();" class="back-btn">‚Üê</button>
                        <h2>–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
                    </div>

                    <div class="details-list">
                        ${currentMonthDays.map(day => `
                            <div class="detail-card">
                                <div class="detail-header">
                                    <div>
                                        <p class="detail-date">üìÖ ${formatDate(day.date)}</p>
                                        <p class="detail-company">${day.categoryName}</p>
                                    </div>
                                    <button onclick="handleDeleteWorkDay('${day.id}')" class="delete-btn">
                                        üóëÔ∏è
                                    </button>
                                </div>
                                <div class="detail-footer">
                                    <p class="detail-value">${day.value} ${getValueLabel(day.valueType)}</p>
                                    <p class="detail-amount">${formatCurrency(day.amount)}</p>
                                </div>
                            </div>
                        `).join('')}
                        
                        ${currentMonthDays.length === 0 ? `
                            <div class="empty-state">
                                <p>–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ —Ü–µ–π –º—ñ—Å—è—Ü—å</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderCategories() {
            return `
                <div class="categories-screen">
                    <div class="form-header">
                        <button onclick="view = 'home'; render();" class="back-btn">‚Üê</button>
                        <h2>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
                    </div>

                    <div class="categories-list">
                        ${categories.map(cat => `
                            <div class="category-card">
                                <div>
                                    <p class="category-name">${cat.name}</p>
                                    <p class="category-type">
                                        ${cat.type === 'km_rules' ? '–ü—Ä–∞–≤–∏–ª–∞ –∑–∞ –∫—ñ–ª–æ–º–µ—Ç—Ä–∏' : `‚Ç¥${cat.rate} –∑–∞ ${cat.valueType}`}
                                    </p>
                                    ${cat.rules ? `
                                        <p class="category-rules">
                                            –î–æ ${cat.rules[0].limit}–∫–º: ‚Ç¥${cat.rules[0].rate}/–∫–º, –ø–æ–Ω–∞–¥: ‚Ç¥${cat.rules[1].rate}/–∫–º
                                        </p>
                                    ` : ''}
                                </div>
                                <button onclick="handleDeleteCategory('${cat.id}')" class="delete-btn">
                                    üóëÔ∏è
                                </button>
                            </div>
                        `).join('')}
                        
                        ${categories.length === 0 ? `
                            <div class="empty-state">
                                <p>–ù–µ–º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</p>
                                <p class="hint">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</p>
                            </div>
                        ` : ''}
                    </div>

                    <button onclick="view = 'addCategory'; render();" class="fab">
                        <span class="fab-icon">+</span>
                    </button>
                </div>
            `;
        }

        function renderAddCategory() {
            return `
                <div class="form-screen">
                    <div class="form-header">
                        <button onclick="view = 'categories'; render();" class="back-btn">‚Üê</button>
                        <h2>–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è</h2>
                    </div>

                    <div class="form-card">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó</label>
                            <input type="text" id="catName" value="${categoryForm.name}" 
                                placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: Novus, Raben, –ó–°–£"
                                onchange="categoryForm.name = this.value;">
                        </div>

                        <div class="form-group">
                            <label>–¢–∏–ø –æ–ø–ª–∞—Ç–∏</label>
                            <select id="catType" onchange="categoryForm.type = this.value; render();">
                                <option value="simple" ${categoryForm.type === 'simple' ? 'selected' : ''}>
                                    –ü—Ä–æ—Å—Ç–∞ —Å—Ç–∞–≤–∫–∞ (‚Ç¥ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é)
                                </option>
                                <option value="km_rules" ${categoryForm.type === 'km_rules' ? 'selected' : ''}>
                                    –ü—Ä–∞–≤–∏–ª–∞ –∑–∞ –∫—ñ–ª–æ–º–µ—Ç—Ä–∞–º–∏ (—è–∫ Novus)
                                </option>
                            </select>
                        </div>

                        ${categoryForm.type === 'simple' ? `
                            <div class="form-group">
                                <label>–°—Ç–∞–≤–∫–∞ (‚Ç¥)</label>
                                <input type="number" id="catRate" value="${categoryForm.rate}" 
                                    placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 850"
                                    onchange="categoryForm.rate = this.value;">
                            </div>
                        ` : ''}

                        ${categoryForm.type === 'km_rules' ? `
                            <div class="rules-group">
                                <p class="rules-title">–ü—Ä–∞–≤–∏–ª–æ 1: –î–æ –ª—ñ–º—ñ—Ç—É</p>
                                <div class="rules-inputs">
                                    <div class="form-group">
                                        <label>–õ—ñ–º—ñ—Ç (–∫–º)</label>
                                        <input type="number" value="${categoryForm.rule1Limit}" 
                                            onchange="categoryForm.rule1Limit = this.value;">
                                    </div>
                                    <div class="form-group">
                                        <label>–°—Ç–∞–≤–∫–∞ (‚Ç¥/–∫–º)</label>
                                        <input type="number" value="${categoryForm.rule1Rate}" 
                                            onchange="categoryForm.rule1Rate = this.value;">
                                    </div>
                                </div>
                            </div>

                            <div class="rules-group">
                                <p class="rules-title">–ü—Ä–∞–≤–∏–ª–æ 2: –ü–æ–Ω–∞–¥ –ª—ñ–º—ñ—Ç</p>
                                <div class="form-group">
                                    <label>–°—Ç–∞–≤–∫–∞ (‚Ç¥/–∫–º)</label>
                                    <input type="number" value="${categoryForm.rule2Rate}" 
                                        onchange="categoryForm.rule2Rate = this.value;">
                                </div>
                            </div>
                        ` : ''}

                        <button onclick="handleAddCategory()" 
                            ${!categoryForm.name || (categoryForm.type === 'simple' && !categoryForm.rate) ? 'disabled' : ''}
                            class="submit-btn">
                            –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                        </button>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (showSplash) {
                app.innerHTML = renderSplash();
            } else {
                if (view === 'home') app.innerHTML = renderHome();
                else if (view === 'add') app.innerHTML = renderAddForm();
                else if (view === 'details') app.innerHTML = renderDetails();
                else if (view === 'categories') app.innerHTML = renderCategories();
                else if (view === 'addCategory') app.innerHTML = renderAddCategory();
            }
        }

        // Initialize
        loadData();
        render();

        // Show continue button after 10 seconds
        setTimeout(() => {
            splashAnimationComplete = true;
            render();
        }, 10000);
    </script>
</body>
</html>
